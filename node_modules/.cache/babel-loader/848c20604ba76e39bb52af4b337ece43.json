{"ast":null,"code":"var _jsxFileName = \"/Users/utkarsh/projects/question-selector/src/screens/dashboard/index.tsx\";\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { StyleSheet, css } from 'aphrodite';\nimport Button from \"../../components/atoms/Button\";\nimport { STEPS, CONTENT_MODE, moveToNextStep, resetAll } from \"../../redux/actions\";\nimport html2canvas from \"html2canvas\";\nimport { requestAPICall } from \"../../util/network\";\n;\n;\nconst DEFAULT_SCALE = 2;\n\nclass Dashboard extends Component {\n  constructor(props) {\n    super(props);\n    this.pdfRef = void 0;\n    this.pdfRef = React.createRef();\n    this.state = {\n      cropping: {\n        value: false\n      },\n      mousePos: {\n        X: 0,\n        Y: 0\n      },\n      values: {}\n    };\n  }\n\n  componentDidMount() {\n    document.addEventListener(\"mousemove\", this.onMouseMove.bind(this), false);\n    document.addEventListener(\"keydown\", this.onKeyDown.bind(this), false);\n    document.addEventListener(\"keyup\", this.onKeyUp.bind(this), false); //  console.log(this.pdfRef.current.contentWindow.document);\n  }\n\n  componentDidUpdate() {\n    if (this.props.step === STEPS.SUBMIT) {\n      // Finally submit the form.\n      const question = this.props.values[STEPS.QUESTION];\n      const answers = {\n        1: this.props.values[STEPS.ANSWER_1],\n        2: this.props.values[STEPS.ANSWER_2],\n        3: this.props.values[STEPS.ANSWER_3],\n        4: this.props.values[STEPS.ANSWER_4]\n      };\n      const correct_answer = this.props.values[STEPS.CORRECT_ANSWER];\n      const payload = {\n        question,\n        answers,\n        correct_answer\n      };\n      const data = requestAPICall(\"/addQuestionSelector\", payload);\n      requestAPICall(\"/addQuestionSelector\", payload).then(({\n        data\n      }) => {\n        this.props.resetAll();\n      });\n    }\n  }\n\n  cropCanvas(sourceCanvas, left, top, width, height) {\n    let destCanvas = document.createElement('canvas');\n    destCanvas.width = width;\n    destCanvas.height = height;\n    destCanvas.getContext(\"2d\").drawImage(sourceCanvas, left, top, width, height, // source rect with content to crop\n    0, 0, width, height); // newCanvas, same size as source rect\n\n    return destCanvas;\n  }\n\n  async onMouseMove(event) {\n    this.setState({\n      mousePos: {\n        X: event.clientX,\n        Y: event.clientY\n      }\n    });\n  }\n\n  async onKeyUp(event) {\n    if (this.state.cropping.value && event.keyCode == 16) {\n      const width = Math.abs(this.state.mousePos.X - this.state.cropping.clientX);\n      const height = Math.abs(this.state.mousePos.Y - this.state.cropping.clientY);\n      document.body.style.cursor = \"default\";\n      const style = document.getElementById(\"myStyle\");\n\n      if (style) {\n        style.textContent = \"\";\n      }\n\n      const canvas = await html2canvas(document.querySelector(\"body\"), {\n        scale: DEFAULT_SCALE\n      });\n      const new_canvas = this.cropCanvas(canvas, this.state.cropping.clientX * DEFAULT_SCALE, this.state.cropping.clientY * DEFAULT_SCALE, width * DEFAULT_SCALE, height * DEFAULT_SCALE);\n      this.moveToNextStep(new_canvas.toDataURL(\"image/png\"), CONTENT_MODE.IMAGE);\n      this.setState({\n        cropping: {\n          value: false\n        }\n      });\n    }\n  }\n\n  moveToNextStep(content, mode) {\n    if (this.props.step !== STEPS.SUBMIT) {\n      this.props.moveToNextStep(this.props.step, {\n        content,\n        mode\n      });\n    }\n  }\n\n  async onKeyDown(event) {\n    console.log(\"Presesd\");\n    const key = event.keyCode;\n    const ctrl = event.ctrlKey || event.metaKey;\n\n    if (ctrl && key == 67) {\n      // ctrl + c\n      console.log(\"LAA\");\n      const content = await navigator.clipboard.readText();\n      this.moveToNextStep(content, CONTENT_MODE.TEXT);\n    } else if (key == 16) {\n      this.setState({\n        cropping: {\n          value: true,\n          clientX: this.state.mousePos.X,\n          clientY: this.state.mousePos.Y\n        }\n      }); // document.body.style.cursor=\"none\";\n\n      document.body.style.cursor = \"crosshair\";\n      const style = document.getElementById(\"myStyle\") ? document.getElementById(\"myStyle\") : document.createElement(\"style\");\n      style.id = \"myStyle\";\n      style.textContent = \"\\n                .textLayer > span{\\n                    cursor: crosshair;\\n                    -webkit-touch-callout: none; /* iOS Safari */\\n                    -webkit-user-select: none; /* Safari */\\n                     -khtml-user-select: none; /* Konqueror HTML */\\n                       -moz-user-select: none; /* Old versions of Firefox */\\n                        -ms-user-select: none; /* Internet Explorer/Edge */\\n                            user-select: none; /* Non-prefixed version, currently\\n                                                  supported by Chrome, Opera and Firefox */\\n                }\\n            \";\n\n      if (!document.getElementById(\"myStyle\")) {\n        document.body.appendChild(style);\n      }\n    }\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      className: css(styles.container),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: css(styles.stepsSection),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 139\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: css(styles.stepsHeading),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140\n      },\n      __self: this\n    }, \"Steps\"), React.createElement(\"div\", {\n      className: css(styles.buttonsContainer),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141\n      },\n      __self: this\n    }, React.createElement(Button, {\n      text: \"Select Question\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142\n      },\n      __self: this\n    }), React.createElement(Button, {\n      text: \"Select Answer 1\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143\n      },\n      __self: this\n    }), React.createElement(Button, {\n      text: \"Select Answer 2\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144\n      },\n      __self: this\n    }), React.createElement(Button, {\n      text: \"Select Answer 3\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145\n      },\n      __self: this\n    }), React.createElement(Button, {\n      text: \"Select Answer 4\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146\n      },\n      __self: this\n    }), React.createElement(Button, {\n      text: \"Select Correct Answer\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147\n      },\n      __self: this\n    }))));\n  }\n\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    display: \"flex\",\n    background: \"#fff\"\n  },\n  stepsSection: {\n    flex: 1,\n    display: \"flex\",\n    flexDirection: \"column\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    width: \"100%\",\n    height: \"100vh\",\n    fontSize: '1.3rem'\n  },\n  buttonsContainer: {},\n  stepsHeading: {\n    marginBottom: \"1rem\"\n  }\n});\n\nconst mapStateToProps = ({\n  app\n}) => ({\n  step: app.step,\n  values: app.values\n});\n\nconst mapDispatchToProps = {\n  moveToNextStep,\n  resetAll\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(Dashboard);","map":{"version":3,"sources":["/Users/utkarsh/projects/question-selector/src/screens/dashboard/index.tsx"],"names":["React","Component","connect","StyleSheet","css","Button","STEPS","CONTENT_MODE","moveToNextStep","resetAll","html2canvas","requestAPICall","DEFAULT_SCALE","Dashboard","constructor","props","pdfRef","createRef","state","cropping","value","mousePos","X","Y","values","componentDidMount","document","addEventListener","onMouseMove","bind","onKeyDown","onKeyUp","componentDidUpdate","step","SUBMIT","question","QUESTION","answers","ANSWER_1","ANSWER_2","ANSWER_3","ANSWER_4","correct_answer","CORRECT_ANSWER","payload","data","then","cropCanvas","sourceCanvas","left","top","width","height","destCanvas","createElement","getContext","drawImage","event","setState","clientX","clientY","keyCode","Math","abs","body","style","cursor","getElementById","textContent","canvas","querySelector","scale","new_canvas","toDataURL","IMAGE","content","mode","console","log","key","ctrl","ctrlKey","metaKey","navigator","clipboard","readText","TEXT","id","appendChild","render","styles","container","stepsSection","stepsHeading","buttonsContainer","create","display","background","flex","flexDirection","alignItems","justifyContent","fontSize","marginBottom","mapStateToProps","app","mapDispatchToProps"],"mappings":"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","sourcesContent":["import React, { Component, Ref, RefObject, MutableRefObject } from 'react';\nimport { connect } from 'react-redux';\nimport PDFViewer from '../../components/molecules/Pdf';\nimport { StyleSheet, css } from 'aphrodite';\nimport Button from \"../../components/atoms/Button\";\nimport { STEPS, CONTENT_MODE, moveToNextStep, resetAll } from \"../../redux/actions\";\nimport PDFJSBackend from \"../../backends/pdfjs\";\nimport html2canvas from \"html2canvas\";\nimport {requestAPICall} from \"../../util/network\";\n\ninterface iProps {\n\n};\ninterface iState {\n\n};\n\nconst DEFAULT_SCALE = 2;\n\nclass Dashboard extends Component<any, any>{\n    pdfRef: any;\n\n    constructor(props: iProps) {\n        super(props);\n        this.pdfRef = React.createRef();\n        this.state = {\n            cropping: {\n                value: false\n            },\n            mousePos: {\n                X: 0,\n                Y: 0\n            },\n            values: {\n\n            }\n        }\n    }\n\n    componentDidMount() {\n        document.addEventListener(\"mousemove\", this.onMouseMove.bind(this), false);\n        document.addEventListener(\"keydown\", this.onKeyDown.bind(this), false);\n        document.addEventListener(\"keyup\", this.onKeyUp.bind(this), false);\n        //  console.log(this.pdfRef.current.contentWindow.document);\n    }\n\n    componentDidUpdate(){\n        if(this.props.step === STEPS.SUBMIT){\n            // Finally submit the form.\n            const question = this.props.values[STEPS.QUESTION];\n            const answers = {\n                1: this.props.values[STEPS.ANSWER_1],\n                2: this.props.values[STEPS.ANSWER_2],\n                3: this.props.values[STEPS.ANSWER_3],\n                4: this.props.values[STEPS.ANSWER_4],\n            };\n            const correct_answer = this.props.values[STEPS.CORRECT_ANSWER];\n            const payload = {question, answers, correct_answer};\n            const data  = requestAPICall(\"/addQuestionSelector\", payload);\n            requestAPICall(\"/addQuestionSelector\", payload).then(({data})=>{\n                this.props.resetAll();\n            });\n        }\n    }\n\n    cropCanvas(sourceCanvas: HTMLCanvasElement, left: number, top: number, width: number ,height:number){\n        let destCanvas = document.createElement('canvas');\n        destCanvas.width = width;\n        destCanvas.height = height;\n        destCanvas.getContext(\"2d\").drawImage(\n            sourceCanvas,\n            left,top,width,height,  // source rect with content to crop\n            0,0,width,height);      // newCanvas, same size as source rect\n        return destCanvas;\n    }\n    async onMouseMove(event: MouseEvent){\n        this.setState({mousePos: {X: event.clientX, Y: event.clientY}});\n    }\n\n    async onKeyUp(event: KeyboardEvent){\n        if(this.state.cropping.value && event.keyCode==16){\n            const width = Math.abs(this.state.mousePos.X - this.state.cropping.clientX);\n            const height = Math.abs(this.state.mousePos.Y - this.state.cropping.clientY);\n            document.body.style.cursor=\"default\";\n            const style = document.getElementById(\"myStyle\");\n\n            if(style){\n                style.textContent = \"\";\n            }\n            const canvas = await html2canvas(document.querySelector(\"body\"), {scale: DEFAULT_SCALE});\n            const new_canvas = this.cropCanvas(canvas, this.state.cropping.clientX * DEFAULT_SCALE, this.state.cropping.clientY * DEFAULT_SCALE, width * DEFAULT_SCALE, height * DEFAULT_SCALE);\n            this.moveToNextStep(new_canvas.toDataURL(\"image/png\"), CONTENT_MODE.IMAGE);\n            this.setState({cropping: {value: false}});\n        }\n    }\n\n    moveToNextStep(content: any, mode: number) {\n        if(this.props.step !== STEPS.SUBMIT){\n            this.props.moveToNextStep(this.props.step, {content, mode});\n        }\n    }\n\n    async onKeyDown(event: KeyboardEvent) {\n        console.log(\"Presesd\");\n        const key = event.keyCode;\n        const ctrl = event.ctrlKey || event.metaKey;\n        if (ctrl && key == 67) {\n            // ctrl + c\n            console.log(\"LAA\");\n            const content = await navigator.clipboard.readText();\n            this.moveToNextStep(content, CONTENT_MODE.TEXT);\n        } else if(key == 16){\n            this.setState({cropping: {value: true, clientX: this.state.mousePos.X, clientY: this.state.mousePos.Y }});\n            // document.body.style.cursor=\"none\";\n            document.body.style.cursor=\"crosshair\";\n            const style: HTMLStyleElement = document.getElementById(\"myStyle\") ? document.getElementById(\"myStyle\") as HTMLStyleElement :  document.createElement(\"style\");\n            style.id = \"myStyle\";\n            style.textContent = `\n                .textLayer > span{\n                    cursor: crosshair;\n                    -webkit-touch-callout: none; /* iOS Safari */\n                    -webkit-user-select: none; /* Safari */\n                     -khtml-user-select: none; /* Konqueror HTML */\n                       -moz-user-select: none; /* Old versions of Firefox */\n                        -ms-user-select: none; /* Internet Explorer/Edge */\n                            user-select: none; /* Non-prefixed version, currently\n                                                  supported by Chrome, Opera and Firefox */\n                }\n            `\n            if(!document.getElementById(\"myStyle\")){\n                document.body.appendChild(style);\n            }\n        }\n    }\n\n    render() {\n        return (\n            <div className={css(styles.container)}>\n                <div className={css(styles.stepsSection)}>\n                    <div className={css(styles.stepsHeading)}>Steps</div>\n                    <div className={css(styles.buttonsContainer)}>\n                        <Button text=\"Select Question\"></Button>\n                        <Button text=\"Select Answer 1\"></Button>\n                        <Button text=\"Select Answer 2\"></Button>\n                        <Button text=\"Select Answer 3\"></Button>\n                        <Button text=\"Select Answer 4\"></Button>\n                        <Button text=\"Select Correct Answer\"></Button>\n                    </div>\n\n                </div>\n            </div>\n        )\n    };\n}\n\nconst styles = StyleSheet.create({\n    container: {\n        display: \"flex\",\n        background: \"#fff\"\n    },\n    stepsSection: {\n        flex: 1,\n        display: \"flex\",\n        flexDirection: \"column\",\n        alignItems: \"center\",\n        justifyContent: \"center\",\n        width: \"100%\",\n        height: \"100vh\",\n        fontSize: '1.3rem'\n    },\n    buttonsContainer: {\n\n    },\n    stepsHeading: {\n        marginBottom: \"1rem\"\n    }\n});\n\nconst mapStateToProps = ({ app }: any) => ({\n    step: app.step,\n    values: app.values\n});\n\nconst mapDispatchToProps = {\n    moveToNextStep,\n    resetAll\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps,\n)(Dashboard);"]},"metadata":{},"sourceType":"module"}